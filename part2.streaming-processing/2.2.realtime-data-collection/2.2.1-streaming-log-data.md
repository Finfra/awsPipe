# 2.4 실시간 로그 데이터 스트리밍

## 개요
이 문서는 웹/애플리케이션 로그를 실시간으로 AWS Kinesis로 전송하는 파이썬 기반 스트리밍 파이프라인의 구조와 활용법을 설명합니다.  
실시간 로그 수집, 파싱, 배치 전송, 테스트 로그 생성 등 실습에 필요한 모든 내용을 다룹니다.

---

## 주요 기능 및 구조

### 1. 실시간 로그 스트리밍: `2.4-streaming-log-data.py`
- **기능:**  
  - Apache/Nginx/애플리케이션 로그를 tail 방식으로 읽어 실시간 파싱
  - 파싱된 로그를 Kinesis 스트림으로 배치 전송(최대 500개/5초 단위)
  - 다양한 로그 포맷 지원(정규식, JSON 등)
  - 통계 출력, 오류 처리, 멀티스레드 구조
- **주요 클래스/함수:**  
  - `LogStreamer`: 실시간 로그 파싱 및 Kinesis 전송
  - `LogGenerator`: 테스트용 로그 파일 생성
  - `parse_apache_log`, `parse_nginx_log`, `parse_application_log`: 각 로그 포맷별 파싱
  - `send_to_kinesis_batch`: Kinesis로 배치 전송
  - `start_streaming`: 전체 스트리밍 파이프라인 실행

---

## 실행 및 실습 가이드

### 1. 실시간 스트리밍 실행
```bash
python 2.4-streaming-log-data.py --stream-name my-log-stream --region ap-northeast-2 --log-files '[{"path":"/var/log/apache2/access.log","type":"apache"}]'
```

### 2. 테스트 로그 생성 옵션
```bash
python 2.4-streaming-log-data.py --stream-name my-log-stream --log-files '[{"path":"./test-access.log","type":"apache"}]' --generate-test-logs
```

### 3. 로그 파일 설정 예시(JSON)
```json
[
  {"path": "/var/log/apache2/access.log", "type": "apache"},
  {"path": "/var/log/nginx/access.log", "type": "nginx"},
  {"path": "/var/log/myapp/app.log", "type": "application"}
]
```

---

## 코드 인용 예시

```python
def parse_apache_log(self, log_line):
    # Combined 로그 형식 정규식
    pattern = r'(\S+) \S+ \S+ \[([\w:/]+\s[+\-]\d{4})\] "(\S+) (\S+) (\S+)" (\d{3}) (\d+|-) "([^"]*)" "([^"]*)"'
    match = re.match(pattern, log_line.strip())
    ...
```

---

## 실습/운영 팁

- Kinesis 스트림, IAM 권한, boto3 환경 등 AWS 리소스 사전 준비 필요
- 다양한 로그 포맷을 동시에 수집하려면 log-files 인자에 여러 파일/타입을 JSON 배열로 지정
- --generate-test-logs 옵션으로 실제 로그 없이도 스트리밍 파이프라인 테스트 가능
- 실시간 통계/오류/큐 상태는 로그로 주기적 출력

---

## 코드/문서 분리 원칙

- **코드(py):** 실제 실행 로직만 포함, 주석 최소화
- **문서(md):** 전체 흐름, 목적, 실습 가이드, 주요 코드 인용, 실행법 등 설명 중심

---
