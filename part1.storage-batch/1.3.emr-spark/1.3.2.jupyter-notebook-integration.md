# 1.3.2. Jupyter Notebook 연동

## 개요
EMR 클러스터에서 Jupyter Notebook을 활용한 대화형 데이터 분석 환경 구축

## EMR Studio vs EMR Notebooks
* **EMR Studio**: AWS 관리형 Jupyter 환경 (권장)
* **EMR Notebooks**: 클러스터 직접 설치 방식

## 실행 방법

### 1. EMR Studio 환경 구성
```bash
# Terraform으로 EMR Studio 배포
cd 1.3.2.src
terraform init
terraform apply

# 변수 설정
export TF_VAR_project_name="bigdata-pipeline"
export TF_VAR_s3_bucket_name="$(cat ~/BUCKET_NAME)"
```

### 2. 클러스터 직접 설치
```bash
# Jupyter 환경 설정 및 설치
./1.3.2.src/setup-jupyter.sh j-XXXXXXXXXX

# 포트 포워딩으로 로컬 접속
ssh -i ~/.ssh/my-key.pem -L 8888:localhost:8888 hadoop@master-dns
```

### 3. 노트북 환경 초기화
```python
# 1.3.2.src/notebook-setup.py 실행
%run 1.3.2.src/notebook-setup.py

# Spark 세션 생성
spark = create_spark_session("Data-Analysis")

# 데이터 로드
events_df = load_datalake_data(spark, $(cat ~/BUCKET_NAME), "silver", "events")
```

### 4. 시각화 및 대시보드
```python
# 시각화 함수 로드
%run 1.3.2.src/visualization.py

# 트렌드 시각화
visualize_trends(events_df, "date", "value", "category")

# 실시간 모니터링 대시보드
monitor = RealTimeMonitor(spark, "s3://bucket/silver/events/")
monitor.create_dashboard()
```

### 5. 고급 분석 실행
```python
# 고급 분석 함수 로드
%run 1.3.2.src/advanced-analytics.py

# 사용자 행동 분석
user_segments = analyze_user_behavior(events_df)
user_segments.groupBy("customer_segment").count().show()

# 코호트 분석
cohort_df = create_cohort_analysis(spark, events_df)
cohort_df.show(20)
```

## 소스 파일 구성

### 인프라 설정
* **emr-studio.tf**: EMR Studio Terraform 구성
* **setup-jupyter.sh**: 클러스터 직접 Jupyter 설치

### Python 라이브러리
* **notebook-setup.py**: 환경 설정 및 기본 함수
* **visualization.py**: 시각화 및 대시보드 함수
* **advanced-analytics.py**: 고급 분석 및 ML 피처 함수

### 실행 권한 설정
```bash
chmod +x 1.3.2.src/*.sh
```

## 주요 기능

### 대화형 데이터 탐색
* DataFrame 스키마 및 통계 정보 자동 표시
* 샘플링을 통한 대용량 데이터 효율적 탐색
* 결측값 및 데이터 품질 자동 검사

### 실시간 시각화
* Matplotlib/Seaborn 기반 차트 생성
* 인터랙티브 위젯을 통한 필터링
* 실시간 메트릭 모니터링 대시보드

### 고급 분석 기능
* RFM 분석을 통한 고객 세그멘테이션
* 코호트 분석으로 사용자 리텐션 측정
* 이동평균 및 이상치 탐지
* 머신러닝용 피처 엔지니어링

### 성능 최적화
* DataFrame 캐싱 전략
* 브로드캐스트 조인 활용
* 메모리 효율적 스트리밍 처리
* 파티션 최적화

## 접속 방법

### EMR Studio 접속
1. AWS Console → EMR → Studios
2. 생성된 Studio 선택
3. "Open in JupyterLab" 클릭

### 직접 설치 접속
1. **포트 포워딩**: `ssh -L 8888:localhost:8888 hadoop@master-dns`
2. **브라우저 접속**: `http://localhost:8888`
3. **직접 접속**: `http://master-dns:8888` (보안 그룹 8888 포트 오픈 필요)

## 보안 고려사항
* 프로덕션에서는 Jupyter 토큰/패스워드 설정 필수
* VPC 내부 접근만 허용 (보안 그룹 설정)
* IAM 역할 기반 S3 접근 제어
* HTTPS 인증서 설정 권장
